<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Flota PepsiCo - Panel de Administraci√≥n</title>

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/logout_button.css">
    <link rel="stylesheet" href="assets/css/style_admindash.css">
</head>

<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>CRM Flota PepsiCo</h1>
                <p>Panel de Administraci√≥n</p>
            </div>

            <!-- Bot√≥n SOLO para celular: abre/cierra el men√∫ de m√≥dulos -->
            <button class="sidebar-mobile-toggle" id="mobileModulesToggle">
                <span class="sidebar-mobile-label">M√≥dulo</span>
                <span class="sidebar-mobile-current" id="mobileModulesCurrent">Gestionar Usuarios</span>
                <span class="sidebar-mobile-arrow">‚ñæ</span>
            </button>

            <!-- Men√∫ original de m√≥dulos (mismo HTML, mismos √≠conos) -->
            <nav class="sidebar-menu" id="sidebarMenu">
                <div class="menu-item active" data-section="usuarios">
                    <i>üë•</i> Gestionar Usuarios
                </div>
                <div class="menu-item" data-section="flota">
                    <i>üöõ</i> Gesti√≥n de Flota
                </div>
                <div class="menu-item" data-section="reportes">
                    <i>üìä</i> Reportes y Estad√≠sticas
                </div>
                <div class="menu-item" data-section="historiales">
                    <i>üìú</i> Historiales
                </div>
                <div class="menu-item" data-section="configuracion">
                    <i>‚öôÔ∏è</i> Configuraci√≥n
                </div>
            </nav>
        </aside>


        <!-- Main Content -->
        <main class="main-content">
            <!-- Header com√∫n con informaci√≥n de usuario -->
            <header class="content-header main-header">
                <div class="header-left">
                    <h2 id="sectionTitle">Gesti√≥n de Usuarios</h2>
                </div>

                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div class="user-meta">
                        <div class="user-name">Administrador</div>
                        <div class="user-email">admin@pepsico.cl</div>
                    </div>
                    <button class="btn-logout-admin" id="btnLogout">Cerrar Sesi√≥n</button>
                </div>
            </header>

            <!-- Secci√≥n de Usuarios -->
            <section id="usuarios-section" class="content-section">
                <!-- Dashboard Cards -->
                <div class="dashboard-cards">
                    <article class="card">
                        <div class="card-header">
                            <div class="card-icon user">üë•</div>
                            <div>
                                <div class="card-title">Total Usuarios</div>
                                <div class="card-value">24</div>
                            </div>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-header">
                            <div class="card-icon role">üë®‚Äçüíº</div>
                            <div>
                                <div class="card-title">Perfiles Activos</div>
                                <div class="card-value">6</div>
                            </div>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-header">
                            <div class="card-icon active">‚úÖ</div>
                            <div>
                                <div class="card-title">Usuarios Activos</div>
                                <div class="card-value">18</div>
                            </div>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-header">
                            <div class="card-icon inactive">‚è∏Ô∏è</div>
                            <div>
                                <div class="card-title">Usuarios Inactivos</div>
                                <div class="card-value">6</div>
                            </div>
                        </div>
                    </article>
                </div>

                <!-- Users Table -->
                <div class="section-bar">
                    <h3>Lista de Usuarios</h3>
                    <button class="btn-add" id="addUserBtn">
                        <i>+</i> Agregar Usuario
                    </button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Correo</th>
                                <th>Cargo</th>
                                <th>Perfil</th>
                                <th>Estado</th>
                                <th>Horario</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Los usuarios se cargar√°n aqu√≠ con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>
            <!-- Fin Secci√≥n de Usuarios -->

            <!-- Secci√≥n de Flota -->
            <section id="flota-section" class="content-section" style="display: none;">
                <div id="vehicles-container"></div>
            </section>

            <!-- Secci√≥n de Historiales -->
            <section id="historiales-section" class="content-section" style="display: none;">
                <div class="filter-block">
                    <label for="historial-type-select" class="filter-label">
                        Seleccionar Tipo de Historial:
                    </label>
                    <select id="historial-type-select" class="filter-select">
                        <option value="solicitudes_repuestos">Solicitudes de Repuestos</option>
                        <option value="movimientos_repuestos">Movimientos de Repuestos</option>
                        <option value="ordenes_trabajo">√ìrdenes de Trabajo</option>
                        <option value="solicitudes_mantenimiento">Solicitudes de Mantenimiento</option>
                        <option value="log_estados_ot">Cambios de Estado de OTs</option>
                        <option value="entregas_vehiculos">Entregas de Veh√≠culos</option>
                        <option value="breaks_mecanico">Breaks de Mec√°nico</option>
                    </select>
                </div>

                <div id="history-container"></div>
            </section>

            <!-- Secci√≥n de Reportes -->
            <section id="reportes-section" class="content-section" style="display: none;">

                <div class="filter-block">
                    <label for="reporte-type-select" class="filter-label">
                        Seleccionar Tipo de Reporte:
                    </label>
                    <select id="reporte-type-select" class="filter-select">
                        <!-- Opciones cargadas din√°micamente -->
                    </select>
                </div>

                <div id="reports-container"></div>
            </section>

            <!-- Secci√≥n de Configuraci√≥n -->
            <section id="configuracion-section" class="content-section" style="display: none;">

                <div class="table-container config-card">
                    <div class="config-inner">
                        <h3 class="config-title">Opciones de Debug</h3>

                        <div class="config-toggle-row">
                            <div class="config-text">
                                <h4>Modo Debug</h4>
                                <p>
                                    Activa el logging detallado en el frontend y backend para facilitar el debugging.
                                    Cuando est√° activado, se mostrar√°n logs adicionales en la consola del navegador
                                    y en los logs del servidor.
                                </p>
                            </div>

                            <label class="toggle-wrapper">
                                <input type="checkbox" id="debugModeToggle" class="toggle-input">
                                <span class="toggle-slider">
                                    <span class="toggle-knob"></span>
                                </span>
                            </label>
                        </div>

                        <div id="debugStatus" class="debug-status">
                            <strong>Estado:</strong> <span id="debugStatusText">Desactivado</span>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Fin Secci√≥n de Configuraci√≥n -->
        </main>
        <!-- Fin Main Content -->
    </div>

    <!-- Modal para agregar/editar usuario -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Agregar Usuario</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group">
                        <label for="userName">Nombre Completo</label>
                        <input type="text" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Correo Electr√≥nico</label>
                        <input type="email" id="userEmail" required>
                    </div>
                    <div class="form-group" id="passwordGroup">
                        <label for="userPassword">Contrase√±a</label>
                        <input type="password" id="userPassword" required>
                        <small class="form-hint">M√≠nimo 6 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="userRut">RUT</label>
                        <input type="text" id="userRut" placeholder="Ej: 12.345.678-9">
                    </div>
                    <div class="form-group">
                        <label for="userTelefono">Tel√©fono</label>
                        <input type="text" id="userTelefono" placeholder="Ej: +56912345678">
                        <small class="form-hint">Opcional</small>
                    </div>
                    <div class="form-group">
                        <label for="userRole">Perfil</label>
                        <select id="userRole" required>
                            <option value="">Seleccione un perfil</option>
                            <option value="ADMIN">Administrador</option>
                            <option value="JEFE_TALLER">Jefe de Taller</option>
                            <option value="MECANICO">Mec√°nico</option>
                            <option value="CHOFER">Chofer</option>
                            <option value="BODEGUERO">Bodeguero</option>
                            <option value="RECEPCIONISTA">Recepcionista</option>
                            <option value="LOGISTICA">Log√≠stica</option>
                        </select>
                    </div>
                    <div class="form-group" id="statusGroup">
                        <label for="userStatus">Estado</label>
                        <select id="userStatus" required>
                            <option value="active">Activo</option>
                            <option value="inactive">Inactivo</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelBtn">Cancelar</button>
                <button class="btn-save" id="saveUserBtn">Guardar Usuario</button>
            </div>
        </div>
    </div>

    <!-- Modal para ver/editar horario -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Horario de <span id="scheduleUserName">Usuario</span></h3>
                <button class="close-modal" id="closeScheduleModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="schedule-note">
                    Activa los d√≠as que corresponda e ingresa la jornada y la colaci√≥n asociada.
                </p>
                <form id="scheduleForm">
                    <table class="schedule-table">
                        <thead>
                            <tr>
                                <th>D√≠a</th>
                                <th>Activo</th>
                                <th>Jornada</th>
                                <th>Colaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- mismo contenido de d√≠as que ya ten√≠as -->
                            <tr data-day="lunes">
                                <td>Lunes</td>
                                <td>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" class="schedule-active" data-day="lunes">
                                        Disponible
                                    </label>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-start" data-day="lunes">
                                        <span>a</span>
                                        <input type="time" class="schedule-end" data-day="lunes">
                                    </div>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-break-start" data-day="lunes">
                                        <span>a</span>
                                        <input type="time" class="schedule-break-end" data-day="lunes">
                                    </div>
                                </td>
                            </tr>

                            <tr data-day="martes">
                                <td>Martes</td>
                                <td>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" class="schedule-active" data-day="martes">
                                        Disponible
                                    </label>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-start" data-day="martes">
                                        <span>a</span>
                                        <input type="time" class="schedule-end" data-day="martes">
                                    </div>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-break-start" data-day="martes">
                                        <span>a</span>
                                        <input type="time" class="schedule-break-end" data-day="martes">
                                    </div>
                                </td>
                            </tr>

                            <tr data-day="miercoles">
                                <td>Mi√©rcoles</td>
                                <td>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" class="schedule-active" data-day="miercoles">
                                        Disponible
                                    </label>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-start" data-day="miercoles">
                                        <span>a</span>
                                        <input type="time" class="schedule-end" data-day="miercoles">
                                    </div>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-break-start" data-day="miercoles">
                                        <span>a</span>
                                        <input type="time" class="schedule-break-end" data-day="miercoles">
                                    </div>
                                </td>
                            </tr>

                            <tr data-day="jueves">
                                <td>Jueves</td>
                                <td>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" class="schedule-active" data-day="jueves">
                                        Disponible
                                    </label>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-start" data-day="jueves">
                                        <span>a</span>
                                        <input type="time" class="schedule-end" data-day="jueves">
                                    </div>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-break-start" data-day="jueves">
                                        <span>a</span>
                                        <input type="time" class="schedule-break-end" data-day="jueves">
                                    </div>
                                </td>
                            </tr>

                            <tr data-day="viernes">
                                <td>Viernes</td>
                                <td>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" class="schedule-active" data-day="viernes">
                                        Disponible
                                    </label>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-start" data-day="viernes">
                                        <span>a</span>
                                        <input type="time" class="schedule-end" data-day="viernes">
                                    </div>
                                </td>
                                <td>
                                    <div class="schedule-inputs">
                                        <input type="time" class="schedule-break-start" data-day="viernes">
                                        <span>a</span>
                                        <input type="time" class="schedule-break-end" data-day="viernes">
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="scheduleCancelBtn">Cancelar</button>
                <button class="btn-save" id="scheduleSaveBtn">Guardar Horario</button>
            </div>
        </div>
    </div>

    <!-- JS -->
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/config-manager.js"></script>
    <script src="assets/js/debug-logger.js"></script>
    <script src="assets/js/logout_button.js"></script>
    <script src="assets/js/offline-handler.js"></script>
    <script src="assets/js/error-handler.js"></script>
    <script src="assets/js/loading-utils.js"></script>
    <script src="assets/js/pagination.js"></script>
    <script src="assets/js/history-viewer.js"></script>
    <script src="assets/js/reports-viewer.js"></script>
    <script src="assets/js/vehicles-viewer.js"></script>
    <script src="assets/js/admin_dashboard.js" defer></script>

    <!-- Sincronizar men√∫ lateral con desplegable de m√≥dulos -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const moduleSelect = document.getElementById('moduleSelect');
            const menuItems = document.querySelectorAll('.menu-item');

            if (!moduleSelect) return;

            // Cambio desde el select -> simula click en el men√∫ lateral
            moduleSelect.addEventListener('change', function () {
                const section = this.value;
                const item = document.querySelector('.menu-item[data-section="' + section + '"]');
                if (item) {
                    item.click(); // reutiliza la l√≥gica existente en admin_dashboard.js
                }
            });

            // Click en el sidebar -> actualiza valor del select
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.getAttribute('data-section');
                    if (section && moduleSelect.value !== section) {
                        moduleSelect.value = section;
                    }
                });
            });
        });
        document.addEventListener('DOMContentLoaded', () => {
            const toggleBtn = document.getElementById('mobileModulesToggle');
            const sidebarMenu = document.getElementById('sidebarMenu');
            const currentLabel = document.getElementById('mobileModulesCurrent');
            const menuItems = document.querySelectorAll('.menu-item');

            if (!toggleBtn || !sidebarMenu) return;

            // Abre/cierra el dropdown azul
            toggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = sidebarMenu.classList.contains('open');
                if (isOpen) {
                    sidebarMenu.classList.remove('open');
                } else {
                    sidebarMenu.classList.add('open');
                }
            });

            // Click dentro del men√∫ no cierra inmediatamente por burbujeo
            sidebarMenu.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Cerrar al hacer click fuera
            document.addEventListener('click', () => {
                sidebarMenu.classList.remove('open');
            });

            // Cuando eliges un m√≥dulo: se actualiza texto y se cierra
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const text = item.textContent.trim();
                    if (currentLabel) currentLabel.textContent = text;
                    sidebarMenu.classList.remove('open');
                    // NO tocamos la l√≥gica de admin_dashboard.js:
                    // el .click() original ya se ejecuta y cambia el m√≥dulo.
                });
            });
        });
    </script>
</body>

</html>